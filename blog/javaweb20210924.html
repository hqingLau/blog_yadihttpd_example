<!DOCTYPE html>
<html lang="zh">

<head>
    <title>J2EE
- hqinglau的博客 - Orz linux</title>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="sogou_site_verification" content="wEcD18BWjC">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5">
<meta name="description" content="hqinglau的博客，分享Linux，操作系统，编程语言的日志。">
<meta name="keywords" content="Linux,C/C++,个人博客,编程,program,计算机,操作系统">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="/css/index.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.fancybox@2.1.5/source/jquery.fancybox.css">
<link href="/css/my.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/gh/hqinglau/CDN/css/prism.css" rel="stylesheet" />
<style>
  .layui-side {
    position: fixed;
    top: 0;
    background-color: #fff;
    width: 240px;
    margin-left: 10px;
    margin-right: 10px;
    bottom: 0;
  }

  .layui-main {
    margin-top: 40px;
    bottom: 0;
  }

  .header {
    height: 40px;
    width: 100%;
    background-color: #fff;
  }

  .fix-header {
    position: fixed;
    top: 0
  }

  @media screen and (max-device-width:730px) {
    #mySidenav {
      display: none;
    }
  }

  .line {
    width: 100%;
    height: 2px;
    margin: 10px 0;
    overflow: hidden;
    background-color: #eee;
    font-size: 0;
  }
</style>
</head>

<body>
  <script type="text/javascript">
    var ua = navigator.userAgent.toLowerCase();
    var isWeixin = ua.indexOf('micromessenger') != -1;
    if (isWeixin) {
      document.getElementsByTagName('html')[0].innerHTML = "<div style='text-align:right; margin:20px;'>请点击右上角浏览器打开</div><img src='/img/log.jpg' style='display:block;margin:30vh auto;height:20%'></div>";
    }
  </script>
  <script type="text/javascript">
    function openNav() {
      document.getElementById("mySidenav").style.display = "block";

      var windowWidth = document.body.clientWidth;
      if (windowWidth > 700) {
        document.getElementById("mymain").style.marginLeft = "260px";
        document.getElementById("topheader").style.left = "260px";
      }
      else {
        document.getElementById("mymain").style.marginLeft = "0";
      }
      document.getElementById("sidebarbtn").onclick = function () {
        closeNav();
      }

    }

    function closeNav() {
      document.getElementById("mySidenav").style.display = "none";
      document.getElementById("mymain").style.marginLeft = "0";
      document.getElementById("topheader").style.left = "0";
      document.getElementById("sidebarbtn").onclick = function () {
        openNav();
      }

    }
  </script>

  <div>
    <div class="layui-side" id="mySidenav">
      <div class="aside_content" id="aside_content">
        <div class="card-content">
          <div class="card-info-avatar is-center">
            <a href="/">
              <img class="avatar-img" src="https://gitee.com/hqinglau/img/raw/master/logo.jpg" alt="avatar">
            </a>
            <div class="author-info__name">hqinglau的网络日志</div>
            <div class="author-info__description">
              <p>记录Linux, 编程, 操作系统...</p>
            </div>
          </div>
          </br>
        </div>
        <div class="line dk hidden-folded"></div>



        </br>
        <div style="padding-left:50px;">

          <a href="https://orzlinux.cn"
            style="text-decoration:none; color:black;cursor:pointer; font-size:16px; padding-top:5px">
            <span class="fa-stack">
              <i class="fa   fa-lg fa-home fa-stack-1x"></i>
            </span>
            Home
          </a>
          </br>
          <a href="https://github.com/hqinglau"
            style="text-decoration:none; color:black;cursor:pointer; font-size:16px; padding-top:5px">

            <span class="fa-stack">
              <i class="fa  fa-lg fa-github fa-stack-1x"></i>
            </span>
            github
          </a>
          </br>

          <a href="/blog/yadihttpd.html"
            style="text-decoration:none; color:black;cursor:pointer; font-size:16px; padding-top:5px">

            <span class="fa-stack">
              <i class="fa  fa-lg  fa-motorcycle fa-stack-1x"></i>
            </span>
            yadihttpd
          </a>
          </br>
          <a href="/uploadBlog.html"
            style="text-decoration:none; color:black;cursor:pointer; font-size:16px; padding-top:5px">

            <span class="fa-stack">
              <i class="fa  fa-lg  fa-upload fa-stack-1x"></i>
            </span>
            Upload
          </a>
          </br>
          <a href="/blogCategory.html"
            style="text-decoration:none; color:black;cursor:pointer; font-size:16px; padding-top:5px">

            <span class="fa-stack">
              <i class="fa  fa-lg  fa-list fa-stack-1x"></i>
            </span>
            Category
          </a>
          </br>
        </div>




      </div>
    </div>
    <div class="layui-main" id="mymain">
      <div class="header fix-header" id="topheader" style="display:none;">
        <span id="sidebarbtn" style="margin:10px; color: #ccc;font-size:20px;cursor:pointer" onclick="openNav()">&#9776;
        </span>
        <span style="font-size:20px;cursor:pointer;"><a href="https://orzlinux.cn"
            style="text-decoration:none; color:#999; font-size:18px;cursor:pointer;"> hqinglau的博客</a> </span>
      </div>




      <script type="text/javascript">
        var lastW = 0;
        var resizeTimer = null;
        //定义变量获取屏幕视口宽度
        function mywinresize() {

          var windowWidth = document.body.clientWidth;
          if (Math.abs(lastW - windowWidth) < 50) {
            return windowWidth;
          }
          console.log(windowWidth);
          if (windowWidth > 700) {
            openNav();
          }
          else {
            closeNav();
          }
          return windowWidth;
        }
        lastW = mywinresize();
        document.getElementById("topheader").style.display = "block";
        window.addEventListener('resize', function () {
          if (resizeTimer) clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function () {
            lastW = mywinresize();
          }, 500);
        });
      </script>





      <article id="page">
        <div class="article-container">
          <div>
		  <style type="text/css"> img{display:block;margin:0 auto;}</style>
<h1>J2EE</h1><hr>
<style type="text/css"> img{display:block;margin:0 0;}</style>

<h2 id="log4j">log4j</h2>
<h3 id="普通输出">普通输出</h3>
<pre><code class="language-java">public class TestLog4j {
    public static void main(String[] args) {
        System.out.println(&quot;跟踪信息&quot;);
        System.out.println(&quot;调试信息&quot;);
        System.out.println(&quot;输出信息&quot;);
        System.out.println(&quot;警告信息&quot;);
        System.out.println(&quot;错误信息&quot;);
        System.out.println(&quot;致命信息&quot;);
    }
}
</code></pre>
<h3 id="log4j日志输出">log4j日志输出</h3>
<pre><code class="language-java">import org.apache.log4j.BasicConfigurator;
import org.apache.log4j.Level;
import org.apache.log4j.Logger;

public class TestLog4j {
    // 基于类的名称获取日志对象
    static Logger logger = Logger.getLogger(TestLog4j.class);
    public static void main(String[] args){
        //进行默认配置
        BasicConfigurator.configure();
        //设置日志输出级别
        logger.setLevel(Level.DEBUG);
        logger.trace(&quot;跟踪信息&quot;);
        logger.debug(&quot;调试信息&quot;);
        logger.info(&quot;输出信息&quot;);
        logger.warn(&quot;警告信息&quot;);
        logger.error(&quot;错误信息&quot;);
        logger.fatal(&quot;致命信息&quot;);
    }
}
</code></pre>
<p>输出：</p>
<pre><code class="language-shell">0 [main] DEBUG log4j.TestLog4j  - 调试信息
1 [main] INFO log4j.TestLog4j  - 输出信息
1011 [main] WARN log4j.TestLog4j  - 警告信息
1011 [main] ERROR log4j.TestLog4j  - 错误信息
1011 [main] FATAL log4j.TestLog4j  - 致命信息
</code></pre>
<h3 id="配置文件">配置文件</h3>
<pre><code class="language-shell"># log4j.properties
# 设置日志输出的等级为debug,低于debug就不会输出了
# 设置日志输出到两种地方，分别叫做 stdout和 R
log4j.rootLogger=debug, stdout, R

# stdout到控制台
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout

# Pattern to output the caller&#39;s file name and line number.
log4j.appender.stdout.layout.ConversionPattern=%5p [%t] (%F:%L) - %m%n

# 第二个地方R, 以滚动的方式输出到文件，文件名是example.log,
# 文件最大100k, 最多滚动5个文件
log4j.appender.R=org.apache.log4j.RollingFileAppender
log4j.appender.R.File=example.log

log4j.appender.R.MaxFileSize=100KB
# Keep one backup file
log4j.appender.R.MaxBackupIndex=5

log4j.appender.R.layout=org.apache.log4j.PatternLayout
log4j.appender.R.layout.ConversionPattern=%p %t %c - %m%n
</code></pre>
<p><strong>java</strong></p>
<pre><code class="language-java">public class TestLog4j {
    static Logger logger = Logger.getLogger(TestLog4j.class);
    public static void main(String[] args) {
        // 采用指定配置文件
        PropertyConfigurator.configure(ClassLoader.getSystemResource(&quot;log4j.properties&quot;));
        logger.trace(&quot;跟踪信息&quot;);
        logger.debug(&quot;调试信息&quot;);
        logger.info(&quot;输出信息&quot;);
        logger.warn(&quot;警告信息&quot;);
        logger.error(&quot;错误信息&quot;);
        logger.fatal(&quot;致命信息&quot;);
    }
}
</code></pre>
<p><strong>日志</strong></p>
<pre><code class="language-shell">DEBUG [main] (TestLog4j.java:12) - 调试信息
 INFO [main] (TestLog4j.java:13) - 输出信息
 WARN [main] (TestLog4j.java:14) - 警告信息
ERROR [main] (TestLog4j.java:15) - 错误信息
FATAL [main] (TestLog4j.java:16) - 致命信息
</code></pre>
<p><strong>文件</strong></p>
<p><img src="https://gitee.com/hqinglau/img/raw/master/img/20210924132012.png" alt="image-20210924132012405"></p>
<p>也可用xml文件配置。</p>
<h2 id="junit">junit</h2>
<p>待测试的函数</p>
<pre><code class="language-java">public class TestJunit {
    public static int sum(int i,int j) {
        return i+j;
    }
}
</code></pre>
<p>测试：</p>
<pre><code class="language-java">public class TestSum {
    @Before
    public void before() {
        System.out.println(&quot;测试前的准备工作，比如链接数据库等等&quot;);
    }
    @After
    public void after() {
        System.out.println(&quot;测试结束后的工作，比如关闭链接等等&quot;);
    }

    @Test
    public void testSum1() {
        int result = TestJunit.sum(2,3);
        Assert.assertEquals(result,5);

        result = TestJunit.sum(2,6);
        Assert.assertEquals(result,8);
    }

    @Test
    public void testSum2() {
        int result = TestJunit.sum(2,6);
        Assert.assertEquals(result,5);
    }
}
</code></pre>
<p><img src="https://gitee.com/hqinglau/img/raw/master/img/20210924134221.png" alt="image-20210924134221855"></p>
<h2 id="filter">Filter</h2>
<pre><code class="language-java">@WebFilter(urlPatterns = &quot;/*&quot;)
public class DemoFilter implements Filter {
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        Filter.super.init(filterConfig);
        //Filter一定会随着tomcat的启动自启动。
        System.out.println(&quot;DemoFilter init()&quot;);
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;

        String ip = req.getRemoteAddr();
        String url = req.getRequestURI().toString();
        SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
        Date d = new Date();
        String date = sdf.format(d);
        System.out.printf(&quot;%s %s访问了 %s\n&quot;,date,ip,url);
        chain.doFilter(req,resp);
    }

    @Override
    public void destroy() {
        Filter.super.destroy();
    }
}
</code></pre>
<p>输出测试：</p>
<pre><code class="language-shell">2021-09-24 16:08:30 0:0:0:0:0:0:0:1访问了 /
2021-09-24 16:08:44 0:0:0:0:0:0:0:1访问了 /listHero
2021-09-24 16:09:21 0:0:0:0:0:0:0:1访问了 /addHero.html
</code></pre>
<p><code>0:0:0:0:0:0:0:1</code>是 ipv6 的表现形式，对应 ipv4 来说相当于<code>127.0.0.1</code>，也就是本机如果项目部署在本机win7系统，访问时是通过 localhost 来访问，用 Java 获取 ip 地址可能会出现该问题，这时获取的 ip 将是 <code>0:0:0:0:0:0:0:1</code>。</p>
<p>可以通过<code>request.setCharacterEncoding(&quot;UTF-8&quot;);</code>正确获取UTF-8编码的中文，但是如果有很多servlet都需要获取中文，那么就必须<strong>在每个Servlet中增加这段代码。</strong></p>
<p>有一个简便的办法，那就是通过Filter过滤器进行中文处理 ，那么所有的Servlet都不需要单独处理了。</p>
<pre><code class="language-java">    @Override
    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain)
            throws IOException, ServletException {
        HttpServletRequest request = (HttpServletRequest) req;
        HttpServletResponse response = (HttpServletResponse) res;
        request.setCharacterEncoding(&quot;UTF-8&quot;);
        chain.doFilter(request, response);
    }
</code></pre>
<h2 id="listener">Listener</h2>
<h3 id="servletcontextlistener">ServletContextListener</h3>
<p>该接口用于监听Web应用的启动与关闭</p>
<pre><code class="language-java">@WebListener
public class demo implements ServletContextListener {
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        ServletContext application = sce.getServletContext();
        System.out.println(&quot;开启web应用用户名字：&quot;+application.getInitParameter(&quot;userName&quot;));
    }

    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        ServletContext application = sce.getServletContext();
        System.out.println(&quot;关闭web应用用户名字：&quot;+application.getInitParameter(&quot;userName&quot;));
    }
}
</code></pre>
<p>配置xml</p>
<pre><code class="language-xml">&lt;!--    web.xml--&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;userName&lt;/param-name&gt;
        &lt;param-value&gt;web项目的初始化参数&lt;/param-value&gt;
    &lt;/context-param&gt;

output:
开启web应用用户名字：web项目的初始化参数
...
</code></pre>
<h3 id="servletcontextattributelistener">ServletContextAttributeListener</h3>
<p>该接口 用于监听<code>ServletContext</code>范围（<code>application</code>）内属性的改变。</p>
<h3 id="servletrequestlistener与servletrequestattributelistener">ServletRequestListener与ServletRequestAttributeListener</h3>
<p><code>ServletRequestListener</code>用于监听用户请求，而<code>ServletRequestAttributeListener</code>用于监听<code>request</code>范围内属性的变化。</p>
<h3 id="httpsessionlistener与httpsessionattributelistener">HttpSessionListener与HttpSessionAttributeListener</h3>
<p><code>HttpSessionListener</code>监听用户<code>session</code>的开始与结束，而<code>HttpSessionAttributeListener</code>监听<code>HttpSession</code>范围（session）内的属性的改变。</p>
<p>服务器端为了保存用户的状态而创建的一个特殊的对象(即session对象)。</p>
<p>当浏览器第一次访问服务器时，服务器会创建session对象（该对象有一个唯一的id,一般称之为sessionId），接下来服务器会将sessionId以cookie的方式发送给浏览器。当浏览器再次访问服务器时，会将sessionId发送过来，服务器就可以依据sessionId找到对应的sessinon对象。</p>
<h2 id="参考">参考</h2>
<p><a href="https://how2j.cn/module/120.html">log4j</a></p>
<p><a href="https://how2j.cn/stage/13.html">J2EE</a></p>
<p><a href="https://blog.csdn.net/qq_23934475/article/details/80941877">配置拦截器（Filter）时把js、css等静态资源拦截解决方案</a></p>
<p><a href="https://blog.csdn.net/zcl_love_wx/article/details/52072655">Java如何使用Listener</a></p>
</div>


</div>
<br>
<div id="banquan-yadi" style="display:none">
	<blockquote style="line-height:1.2;padding-bottom:10px;">
		<p>本文地址:
			<a href="https://orzlinux.cn" id="blogaddr-a" style="text-decoration:none; color:black;cursor:pointer;">
				hqinglau的博客</a>
		</p>
		<p>作者:
			<a href="https://orzlinux.cn" style="text-decoration:none; color:black;cursor:pointer;">
				hqinglau
			</a>
		</p>
		<p>博客地址:
			<a href="https://orzlinux.cn" style="text-decoration:none; color:black;cursor:pointer;">
				https://orzlinux.cn
			</a>
		</p>

		<p>版权说明: 如无注明，本文皆由
			<a href="https://orzlinux.cn" style="text-decoration:none; color:black;cursor:pointer;">
				hqinglau
			</a>原创，转载请保留文章出处
		</p>
	</blockquote>
</div>
</article>
</div>
<div id="footer-wrap">
	<div class="copyright">Powered by <a style="color:#4c4948;text-decoration:none;" href="https://github.com/hqinglau/yadihttpd">yadihttpd</a>
		|
			<a style="color:#4c4948;text-decoration:none;" href="https://orzlinux.cn/sitemap.xml">sitemap</a>

		| 
		<a href="https://www.cnzz.com/stat/website.php?web_id=1280379355" style="color:#4c4948;text-decoration:none;" target="_blank" title="站长统计">网站统计</a>
		</div>
	<div class="copyright">Copyright © 2021 hqinglau</div>
	<div style="width:300px;margin:0 auto; padding:5px 0;">
		<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41022102001049"
			style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img
				src="https://orzlinux.cn/img/beian.png" style="float:left;">
			<p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">豫公网安备
				41022102001049号</p>
		</a>
	</div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/gh/hqinglau/CDN/js/prism.js"></script>

<!-- 看板娘 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
<script type="text/javascript">document.write(unescape("%3Cspan style='display:none;' id='cnzz_stat_icon_1280379355'%3E%3C/span%3E%3Cscript src='https://s4.cnzz.com/z_stat.php%3Fid%3D1280379355' type='text/javascript'%3E%3C/script%3E"));</script>
<script>
	(function(){
	var el = document.createElement("script");
	el.src = "https://lf1-cdn-tos.bytegoofy.com/goofy/ttzz/push.js?b49908f94659486112caf80ce9c79f8438025d2d666f8d5952ffe1da06a881cb30632485602430134f60bc55ca391050b680e2741bf7233a8f1da9902314a3fa";
	el.id = "ttzz";
	var s = document.getElementsByTagName("script")[0];
	s.parentNode.insertBefore(el, s);
	})(window)
</script>
<script>
	(function(){
	var src = "https://s.ssl.qhres2.com/ssl/ab77b6ea7f3fbf79.js";
	document.write('<script src="' + src + '" id="sozz"><\/script>');
	})();
</script>
<script>
	(function(){
		var bp = document.createElement('script');
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https'){
	   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
	  }
	  else{
	  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	  }
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	})();
</script>
				<script type="text/javascript">
				document.getElementById("banquan-yadi").style.display ="";
			document.getElementById("blogaddr-a").href ="https://orzlinux.cn/blog/"+"javaweb20210924.html";
			document.getElementById("blogaddr-a").innerHTML="J2EE";
			</script></body></html> 
