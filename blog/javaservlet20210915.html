<!DOCTYPE html>
<html lang="zh">

<head>
    <title>Servlet笔记
- hqinglau的博客 - Orz linux</title>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="sogou_site_verification" content="wEcD18BWjC">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5">
<meta name="description" content="hqinglau的博客，分享Linux，操作系统，编程语言的日志。">
<meta name="keywords" content="Linux,C/C++,个人博客,编程,program,计算机,操作系统">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="/css/index.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.fancybox@2.1.5/source/jquery.fancybox.css">
<link href="/css/my.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/gh/hqinglau/CDN/css/prism.css" rel="stylesheet" />
<style>
  .layui-side {
    position: fixed;
    top: 0;
    background-color: #fff;
    width: 240px;
    margin-left: 10px;
    margin-right: 10px;
    bottom: 0;
  }

  .layui-main {
    margin-top: 40px;
    bottom: 0;
  }

  .header {
    height: 40px;
    width: 100%;
    background-color: #fff;
  }

  .fix-header {
    position: fixed;
    top: 0
  }

  @media screen and (max-device-width:730px) {
    #mySidenav {
      display: none;
    }
  }

  .line {
    width: 100%;
    height: 2px;
    margin: 10px 0;
    overflow: hidden;
    background-color: #eee;
    font-size: 0;
  }
</style>
</head>

<body>
  <script type="text/javascript">
    var ua = navigator.userAgent.toLowerCase();
    var isWeixin = ua.indexOf('micromessenger') != -1;
    if (isWeixin) {
      document.getElementsByTagName('html')[0].innerHTML = "<div style='text-align:right; margin:20px;'>请点击右上角浏览器打开</div><img src='/img/log.jpg' style='display:block;margin:30vh auto;height:20%'></div>";
    }
  </script>
  <script type="text/javascript">
    function openNav() {
      document.getElementById("mySidenav").style.display = "block";

      var windowWidth = document.body.clientWidth;
      if (windowWidth > 700) {
        document.getElementById("mymain").style.marginLeft = "260px";
        document.getElementById("topheader").style.left = "260px";
      }
      else {
        document.getElementById("mymain").style.marginLeft = "0";
      }
      document.getElementById("sidebarbtn").onclick = function () {
        closeNav();
      }

    }

    function closeNav() {
      document.getElementById("mySidenav").style.display = "none";
      document.getElementById("mymain").style.marginLeft = "0";
      document.getElementById("topheader").style.left = "0";
      document.getElementById("sidebarbtn").onclick = function () {
        openNav();
      }

    }
  </script>

  <div>
    <div class="layui-side" id="mySidenav">
      <div class="aside_content" id="aside_content">
        <div class="card-content">
          <div class="card-info-avatar is-center">
            <a href="/">
              <img class="avatar-img" src="https://gitee.com/hqinglau/img/raw/master/logo.jpg" alt="avatar">
            </a>
            <div class="author-info__name">hqinglau的网络日志</div>
            <div class="author-info__description">
              <p>记录Linux, 编程, 操作系统...</p>
            </div>
          </div>
          </br>
        </div>
        <div class="line dk hidden-folded"></div>



        </br>
        <div style="padding-left:50px;">

          <a href="https://orzlinux.cn"
            style="text-decoration:none; color:black;cursor:pointer; font-size:16px; padding-top:5px">
            <span class="fa-stack">
              <i class="fa   fa-lg fa-home fa-stack-1x"></i>
            </span>
            Home
          </a>
          </br>
          <a href="https://github.com/hqinglau"
            style="text-decoration:none; color:black;cursor:pointer; font-size:16px; padding-top:5px">

            <span class="fa-stack">
              <i class="fa  fa-lg fa-github fa-stack-1x"></i>
            </span>
            github
          </a>
          </br>

          <a href="/blog/yadihttpd.html"
            style="text-decoration:none; color:black;cursor:pointer; font-size:16px; padding-top:5px">

            <span class="fa-stack">
              <i class="fa  fa-lg  fa-motorcycle fa-stack-1x"></i>
            </span>
            yadihttpd
          </a>
          </br>
          <a href="/uploadBlog.html"
            style="text-decoration:none; color:black;cursor:pointer; font-size:16px; padding-top:5px">

            <span class="fa-stack">
              <i class="fa  fa-lg  fa-upload fa-stack-1x"></i>
            </span>
            Upload
          </a>
          </br>
          <a href="/blogCategory.html"
            style="text-decoration:none; color:black;cursor:pointer; font-size:16px; padding-top:5px">

            <span class="fa-stack">
              <i class="fa  fa-lg  fa-list fa-stack-1x"></i>
            </span>
            Category
          </a>
          </br>
        </div>




      </div>
    </div>
    <div class="layui-main" id="mymain">
      <div class="header fix-header" id="topheader" style="display:none;">
        <span id="sidebarbtn" style="margin:10px; color: #ccc;font-size:20px;cursor:pointer" onclick="openNav()">&#9776;
        </span>
        <span style="font-size:20px;cursor:pointer;"><a href="https://orzlinux.cn"
            style="text-decoration:none; color:#999; font-size:18px;cursor:pointer;"> hqinglau的博客</a> </span>
      </div>




      <script type="text/javascript">
        var lastW = 0;
        var resizeTimer = null;
        //定义变量获取屏幕视口宽度
        function mywinresize() {

          var windowWidth = document.body.clientWidth;
          if (Math.abs(lastW - windowWidth) < 50) {
            return windowWidth;
          }
          console.log(windowWidth);
          if (windowWidth > 700) {
            openNav();
          }
          else {
            closeNav();
          }
          return windowWidth;
        }
        lastW = mywinresize();
        document.getElementById("topheader").style.display = "block";
        window.addEventListener('resize', function () {
          if (resizeTimer) clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function () {
            lastW = mywinresize();
          }, 500);
        });
      </script>





      <article id="page">
        <div class="article-container">
          <div>
		  <style type="text/css"> img{display:block;margin:0 auto;}</style>
<h1>Servlet笔记</h1><hr>
<p>Servlet（Server Applet），全称 Java Servlet，是用Java编写的服务器端程序。其主要功能在于交互式地浏览和修改数据，生成动态Web内容。</p>
<h2 id="工作模式">工作模式</h2>
<p>客户端发送请求至服务器，服务器启动并调用 Servlet，Servlet 根据客户端请求生成响应内容传给服务器，服务器将响应传给客户端。</p>
<p><img src="https://gitee.com/hqinglau/img/raw/master/img/20210915122443.png" alt="image-20210915122442895"></p>
<p>Tomcat 是 Web 应用服务器,是一个 Servlet/JSP 容器。 Tomcat 作为 Servlet 容器，负责处理客户请求，把请求传送给 Servlet，并将Servlet 的响应传送回给客户。而 Servlet 是一种运行在支持Java语言的服务器上的组件。 Servlet 最常见的用途是扩展 Java Web 服务器功能,提供非常安全的，可移植的，易于使用的 CGI 替代品。</p>
<p><img src="https://gitee.com/hqinglau/img/raw/master/img/20210915122823.png" alt="image-20210915122823232"></p>
<h2 id="示例一">示例一</h2>
<pre><code class="language-java">public class HelloServlet extends HttpServlet {
    public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
        System.out.println(&quot;get&quot;);
    }
    public void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException {
        System.out.println(&quot;post&quot;);
    }
}
</code></pre>
<p>web.xml：</p>
<pre><code class="language-xml">&lt;servlet&gt;
    &lt;!--servlet的名字，什么都可以，一般与我们编写的名字相同--&gt;
    &lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;com.lhq.javaweblhq.HelloServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;!-- 上面起的名字--&gt;
    &lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;
    &lt;!--  通过url找到servlet，/必须要加--&gt;
    &lt;url-pattern&gt;/hello&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>
<p>访问链接之后：</p>
<pre><code class="language-shell"># http://localhost:8080/javaweblhq_war_exploded/hello
[2021-09-15 12:50:09,347] Artifact javaweblhq:war exploded: Deploy took 523 milliseconds
get
15-Sep-2021 12:50:18.427
</code></pre>
<h2 id="servlet-原理">Servlet 原理</h2>
<p><code>Servlet</code>  <strong>生命周期</strong>：</p>
<img src="https://gitee.com/hqinglau/img/raw/master/img/20210915125913.png" alt="image-20210915125913452" style="zoom: 75%;" />

<pre><code class="language-java">protected void service(HttpServletRequest req, HttpServletResponse resp)
        throws ServletException, IOException
{
    String method = req.getMethod();

    if (method.equals(METHOD_GET)) {
        long lastModified = getLastModified(req);
        if (lastModified == -1) {
            // servlet doesn&#39;t support if-modified-since, no reason
            // to go through further expensive logic
            doGet(req, resp);
        } else {
            long ifModifiedSince = req.getDateHeader(HEADER_IFMODSINCE);
            if (ifModifiedSince &lt; lastModified) {
                // If the servlet mod time is later, call doGet()
                // Round down to the nearest second for a proper compare
                // A ifModifiedSince of -1 will always be less
                maybeSetLastModified(resp, lastModified);
                doGet(req, resp);
            } else {
                resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
            }
        }

    } else if (method.equals(METHOD_HEAD)) {
        long lastModified = getLastModified(req);
        maybeSetLastModified(resp, lastModified);
        doHead(req, resp);

    } else if (method.equals(METHOD_POST)) {
        doPost(req, resp);

    } else if (method.equals(METHOD_PUT)) {
        doPut(req, resp);

    } else if (method.equals(METHOD_DELETE)) {
        doDelete(req, resp);

    } else if (method.equals(METHOD_OPTIONS)) {
        doOptions(req,resp);

    } else if (method.equals(METHOD_TRACE)) {
        doTrace(req,resp);

    } else {
        //
        // Note that this means NO servlet supports whatever
        // method was requested, anywhere on this server.
        //

        String errMsg = lStrings.getString(&quot;http.method_not_implemented&quot;);
        Object[] errArgs = new Object[1];
        errArgs[0] = method;
        errMsg = MessageFormat.format(errMsg, errArgs);

        resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg);
    }
}
</code></pre>
<p>以示例一为例，继承结构：</p>
<p><img src="https://gitee.com/hqinglau/img/raw/master/img/20210915130925.png" alt="image-20210915130925328"></p>
<p>Servlet 接口内容：</p>
<p><img src="https://gitee.com/hqinglau/img/raw/master/img/20210915131548.png" alt="image-20210915131548152"></p>
<p><code>Servlet</code>生命周期的三个关键方法，<code>init</code>、<code>service</code>、<code>destroy</code>。还有另外两个方法，一个<code>getServletConfig</code>方法来获取<code>ServletConfig</code>对象，<code>ServletConfig</code>对象可以获取到<code>Servlet</code>的一些信息，<code>ServletName</code>、<code>ServletContext</code>、<code>InitParameter</code>、<code>InitParameterNames</code>。</p>
<p><code>ServletContext</code>对象是<code>servlet</code>上下文对象，功能有很多，获得了<code>ServletContext</code>对象，就能获取大部分我们需要的信息，比如获取<code>servlet</code>的路径等方法。</p>
<p>可以通过<code>Servlet</code>的<code>getServletConfig</code>方法获取<code>ServletConfig</code>。</p>
<p><img src="https://gitee.com/hqinglau/img/raw/master/img/20210915132221.png" alt="image-20210915132221319"></p>
<p>web.xml配置如下：</p>
<p><img src="https://gitee.com/hqinglau/img/raw/master/img/20210915132506.png" alt="img"></p>
<p>java：</p>
<pre><code class="language-java">public class HelloServlet extends HttpServlet {
    public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
        System.out.println(&quot;get&quot;);
        System.out.println(&quot;这样也行&quot;+this.getServletName());
        // 继承了genericservlet,它实现了这个，见下图
        // 输出：这样也行HelloServlet
        // 或者 System.out.println(this.getServletConfig().getServletName());
        System.out.println(this.getServletConfig().getInitParameter(&quot;yadiparam&quot;));
        // 输出
        // get
        // HelloServlet
        // 初始化参数测试
    }
    public void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException {
        System.out.println(&quot;post&quot;);
    }
}
</code></pre>
<p><img src="https://gitee.com/hqinglau/img/raw/master/img/20210915133404.png" alt="image-20210915133404949"></p>
<p>tomcat 为每个 web 项目都<strong>创建一个<code>ServletContext</code>实例</strong>，tomcat 在启动时创建，服务器关闭时销毁，在一个 web 项目中共享数据，管理 web 项目资源，为整个 web 配置公共信息等，通俗点讲，就是一个 web 项目，就存在一个<code>ServletContext</code>实例，每个 <code>Servlet</code> 读可以访问到它。</p>
<pre><code class="language-xml">&lt;context-param&gt;
    &lt;param-name&gt;xixi&lt;/param-name&gt;
    &lt;param-value&gt;web项目的初始化参数&lt;/param-value&gt;
&lt;/context-param&gt;
</code></pre>
<p>java:</p>
<pre><code class="language-java">System.out.println(getServletContext().getInitParameter(&quot;xixi&quot;));
</code></pre>
<p><strong>请求转发</strong></p>
<pre><code class="language-java">request.getRequestDispatcher(String path).forward(request,response);
</code></pre>
<p>path：转发后跳转的页面，这里不管用不用&quot;/&quot;开头，都是以web项目根开始，因为这是请求转发，请求转发只局限与在同一个web项目下使用，所以这里一直都是从web项目根下开始的。</p>
<p>特点：浏览器中url不会改变，也就是浏览器不知道服务器做了什么，是服务器帮我们跳转页面的，并且在转发后的页面，能够继续使用原先的request，因为是原先的request，所以request域中的属性都可以继续获取到。</p>
<pre><code class="language-java">response.setHeader(&quot;Refresh&quot;,&quot;3&quot;);
response.getOutputStream().print(request.getRequestURI()+&quot; &quot;+request.getServerName()+&quot; &quot;+new Date().getSeconds());
// 输出 ：/javaweblhq_war_exploded/hello localhost 21
// 3s刷新一次
</code></pre>
<p><code>PrintWriter getWriter()</code></p>
<p>获得字符流，通过字符流的<code>write(String s)</code>方法可以将字符串设置到 response   缓冲区中，随后 Tomcat 会将 response 缓冲区中的内容组装成 Http 响应返回给浏览器端。</p>
<p><code>ServletOutputStream getOutputStream()</code></p>
<p>获得字节流，通过该字节流的<code>write(byte[] bytes)</code>可以向 response 缓冲区中写入字节，再由 Tomcat 服务器将字节内容组成 Http 响应返回给浏览器。</p>
<p>response 对象的<code>getOutSream()</code>和<code>getWriter()</code>方法都可以发送响应消息体，但是他们之间相互排斥，不可以同时使用，否则会发生异常。</p>
<p><strong>中文异常问题：</strong></p>
<p><img src="https://gitee.com/hqinglau/img/raw/master/img/20210915160751.png" alt="image-20210915160751227"></p>
<pre><code class="language-java">response.setContentType(&quot;text/html;charset=utf-8&quot;);
response.getWriter().print(request.getRequestURI()+&quot; &quot;+request.getServerName()+&quot;中文&quot;+new Date().getSeconds());
</code></pre>
<img src="https://gitee.com/hqinglau/img/raw/master/img/20210915160924.png" alt="image-20210915160924867" style="zoom: 70%;" />

<h2 id="参考">参考</h2>
<p><a href="https://blog.csdn.net/qq_19782019/article/details/80292110">JavaWeb——Servlet（全网最详细教程包括Servlet源码分析）</a></p>
<p><a href="https://www.cnblogs.com/whgk/p/6399262.html">Java Web(一) Servlet详解！！</a></p>
</div>


</div>
<br>
<div id="banquan-yadi" style="display:none">
	<blockquote style="line-height:1.2;padding-bottom:10px;">
		<p>本文地址:
			<a href="https://orzlinux.cn" id="blogaddr-a" style="text-decoration:none; color:black;cursor:pointer;">
				hqinglau的博客</a>
		</p>
		<p>作者:
			<a href="https://orzlinux.cn" style="text-decoration:none; color:black;cursor:pointer;">
				hqinglau
			</a>
		</p>
		<p>博客地址:
			<a href="https://orzlinux.cn" style="text-decoration:none; color:black;cursor:pointer;">
				https://orzlinux.cn
			</a>
		</p>

		<p>版权说明: 如无注明，本文皆由
			<a href="https://orzlinux.cn" style="text-decoration:none; color:black;cursor:pointer;">
				hqinglau
			</a>原创，转载请保留文章出处
		</p>
	</blockquote>
</div>
</article>
</div>
<div id="footer-wrap">
	<div class="copyright">Powered by <a style="color:#4c4948;text-decoration:none;" href="https://github.com/hqinglau/yadihttpd">yadihttpd</a>
		|
			<a style="color:#4c4948;text-decoration:none;" href="https://orzlinux.cn/sitemap.xml">sitemap</a>

		| 
		<a href="https://www.cnzz.com/stat/website.php?web_id=1280379355" style="color:#4c4948;text-decoration:none;" target="_blank" title="站长统计">网站统计</a>
		</div>
	<div class="copyright">Copyright © 2021 hqinglau</div>
	<div style="width:300px;margin:0 auto; padding:5px 0;">
		<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41022102001049"
			style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img
				src="https://orzlinux.cn/img/beian.png" style="float:left;">
			<p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">豫公网安备
				41022102001049号</p>
		</a>
	</div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/gh/hqinglau/CDN/js/prism.js"></script>

<!-- 看板娘 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
<script type="text/javascript">document.write(unescape("%3Cspan style='display:none;' id='cnzz_stat_icon_1280379355'%3E%3C/span%3E%3Cscript src='https://s4.cnzz.com/z_stat.php%3Fid%3D1280379355' type='text/javascript'%3E%3C/script%3E"));</script>
<script>
	(function(){
	var el = document.createElement("script");
	el.src = "https://lf1-cdn-tos.bytegoofy.com/goofy/ttzz/push.js?b49908f94659486112caf80ce9c79f8438025d2d666f8d5952ffe1da06a881cb30632485602430134f60bc55ca391050b680e2741bf7233a8f1da9902314a3fa";
	el.id = "ttzz";
	var s = document.getElementsByTagName("script")[0];
	s.parentNode.insertBefore(el, s);
	})(window)
</script>
<script>
	(function(){
	var src = "https://s.ssl.qhres2.com/ssl/ab77b6ea7f3fbf79.js";
	document.write('<script src="' + src + '" id="sozz"><\/script>');
	})();
</script>
<script>
	(function(){
		var bp = document.createElement('script');
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https'){
	   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
	  }
	  else{
	  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	  }
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	})();
</script>
				<script type="text/javascript">
				document.getElementById("banquan-yadi").style.display ="";
			document.getElementById("blogaddr-a").href ="https://orzlinux.cn/blog/"+"javaservlet20210915.html";
			document.getElementById("blogaddr-a").innerHTML="Servlet笔记";
			</script></body></html> 
